<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analog Alarm Clock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the clock and overall page */
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Improves touch responsiveness */
        }

        .clock-face {
            background: #1f2937; /* bg-gray-800 */
            box-shadow: 0 0 0 4px #4b5563, /* bg-gray-600 */
                        inset 0 0 0 3px #374151, /* bg-gray-700 */
                        inset 0 0 10px #111827, /* bg-gray-900 */
                        0 0 10px rgba(0, 0, 0, 0.5);
        }

        .hand {
            transform-origin: bottom center;
            position: absolute;
            bottom: 50%;
            left: 50%;
            border-radius: 9999px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: transform 0.5s cubic-bezier(.4,2.08,.55,.44);
        }

        .hour-hand {
            width: 6px;
            height: 25%;
            background-color: #f3f4f6; /* bg-gray-100 */
        }

        .minute-hand {
            width: 4px;
            height: 35%;
            background-color: #d1d5db; /* bg-gray-300 */
        }

        .second-hand {
            width: 2px;
            height: 40%;
            background-color: #ef4444; /* bg-red-500 */
            transition: transform 0.05s linear; /* Smoother tick for seconds */
        }

        .center-dot {
            width: 12px;
            height: 12px;
            background-color: #ef4444; /* bg-red-500 */
            border: 2px solid #f3f4f6; /* bg-gray-100 */
        }

        .hour-marker {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: #d1d5db; /* text-gray-300 */
        }
        
        /* Modal styles for the alarm alert */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto">
        <!-- Digital Clock Display -->
        <div id="digital-clock" class="text-center mb-6 text-4xl md:text-5xl font-bold font-orbitron tracking-widest">
            00:00:00 AM
        </div>

        <!-- Analog Clock -->
        <div class="relative w-64 h-64 md:w-80 md:h-80 mx-auto">
            <div class="clock-face w-full h-full rounded-full flex items-center justify-center">
                <!-- Hour Markers -->
                <div class="hour-markers"></div>
                <!-- Clock Hands -->
                <div class="hand hour-hand"></div>
                <div class="hand minute-hand"></div>
                <div class="hand second-hand"></div>
                <div class="center-dot absolute w-3 h-3 bg-red-500 rounded-full z-10"></div>
            </div>
        </div>

        <!-- Alarm Controls -->
        <div class="mt-8 p-6 bg-gray-800 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-center mb-4 font-orbitron">Set Alarm</h2>
            <div class="flex items-center justify-center space-x-2 mb-4">
                <select id="alarm-hour" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-lg w-20 text-center appearance-none">
                    <!-- Options will be populated by JS -->
                </select>
                <span class="text-xl font-bold">:</span>
                <select id="alarm-minute" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-lg w-20 text-center appearance-none">
                    <!-- Options will be populated by JS -->
                </select>
                <select id="alarm-ampm" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-lg w-20 text-center appearance-none">
                    <option value="AM">AM</option>
                    <option value="PM">PM</option>
                </select>
            </div>
            <div class="flex space-x-4">
                <button id="set-alarm-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-300">Set Alarm</button>
                <button id="clear-alarm-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg transition duration-300" disabled>Clear Alarm</button>
            </div>
            <div id="alarm-status" class="text-center mt-4 h-6 text-green-400"></div>
        </div>
    </div>

    <!-- Alarm Modal -->
    <div id="alarm-modal" class="modal-overlay">
        <div class="bg-gray-800 rounded-lg p-8 shadow-2xl text-center transform scale-95 transition-transform duration-300">
            <h2 class="text-4xl font-bold text-red-500 mb-4 font-orbitron">ALARM!</h2>
            <p id="alarm-modal-time" class="text-xl mb-6">Time's up!</p>
            <button id="stop-alarm-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-8 rounded-lg transition">Stop</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const hourHand = document.querySelector('.hour-hand');
            const minuteHand = document.querySelector('.minute-hand');
            const secondHand = document.querySelector('.second-hand');
            const digitalClock = document.getElementById('digital-clock');
            const hourMarkersContainer = document.querySelector('.hour-markers');
            
            const alarmHourSelect = document.getElementById('alarm-hour');
            const alarmMinuteSelect = document.getElementById('alarm-minute');
            const alarmAmPmSelect = document.getElementById('alarm-ampm');
            const setAlarmBtn = document.getElementById('set-alarm-btn');
            const clearAlarmBtn = document.getElementById('clear-alarm-btn');
            const alarmStatus = document.getElementById('alarm-status');

            const alarmModal = document.getElementById('alarm-modal');
            const alarmModalTime = document.getElementById('alarm-modal-time');
            const stopAlarmBtn = document.getElementById('stop-alarm-btn');

            // State
            let alarmTime = null;
            let alarmInterval = null;
            let alarmSound;

            // --- Clock Initialization ---

            // Populate hour markers on the clock face
            function createHourMarkers() {
                const clockFace = document.querySelector('.clock-face');
                const radius = clockFace.offsetWidth / 2 * 0.85;
                for (let i = 1; i <= 12; i++) {
                    const angle = (i * 30) * (Math.PI / 180); // 360/12 = 30 degrees per hour
                    const x = radius * Math.sin(angle);
                    const y = -radius * Math.cos(angle);
                    const marker = document.createElement('div');
                    marker.className = 'hour-marker text-lg md:text-xl';
                    marker.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
                    marker.textContent = i;
                    hourMarkersContainer.appendChild(marker);
                }
            }
            
            // Populate select dropdowns for alarm setting
            function populateSelects() {
                for (let i = 1; i <= 12; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i.toString().padStart(2, '0');
                    alarmHourSelect.appendChild(option);
                }
                for (let i = 0; i < 60; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i.toString().padStart(2, '0');
                    alarmMinuteSelect.appendChild(option);
                }
            }

            // --- Clock Update Logic ---

            function setClock() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours();

            // Analog clock update
            // 🐛 FIX: Removed the incorrect '+ 90' degree offset.
            // The default position is already pointing up (12 o'clock).
            const secondsDegrees = (seconds / 60) * 360;
            secondHand.style.transform = `translateX(-50%) rotate(${secondsDegrees}deg)`;

            const minutesDegrees = (minutes / 60) * 360 + (seconds / 60) * 6;
            minuteHand.style.transform = `translateX(-50%) rotate(${minutesDegrees}deg)`;

            // 🐛 FIX: Used the modulo operator (%) to convert the 24-hour format
            // to a 12-hour cycle for the analog hand calculation.
            const hoursForCalc = hours % 12;
            const hoursDegrees = (hoursForCalc / 12) * 360 + (minutes / 60) * 30;
            hourHand.style.transform = `translateX(-50%) rotate(${hoursDegrees}deg)`;

            // Digital clock update (This part was already correct)
            const displayHours = hours % 12 || 12;
            const ampm = hours >= 12 ? 'PM' : 'AM';
            digitalClock.textContent = 
                `${displayHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')} ${ampm}`;
        }
            // --- Alarm Logic ---

            function setAlarm() {
                const hour = parseInt(alarmHourSelect.value);
                const minute = parseInt(alarmMinuteSelect.value);
                const ampm = alarmAmPmSelect.value;

                let hour24 = hour;
                if (ampm === 'PM' && hour < 12) {
                    hour24 += 12;
                }
                if (ampm === 'AM' && hour === 12) { // Midnight case
                    hour24 = 0;
                }

                alarmTime = { hour: hour24, minute };
                
                const displayHour = hour.toString().padStart(2, '0');
                const displayMinute = minute.toString().padStart(2, '0');

                alarmStatus.textContent = `Alarm set for ${displayHour}:${displayMinute} ${ampm}`;
                setAlarmBtn.disabled = true;
                clearAlarmBtn.disabled = false;

                if (!alarmInterval) {
                    alarmInterval = setInterval(checkAlarm, 1000);
                }
            }

            function clearAlarm() {
                if (alarmSound) {
                    alarmSound.stop();
                    Tone.Transport.stop();
                }
                alarmTime = null;
                clearInterval(alarmInterval);
                alarmInterval = null;
                alarmStatus.textContent = '';
                setAlarmBtn.disabled = false;
                clearAlarmBtn.disabled = true;
                hideAlarmModal();
            }

            function checkAlarm() {
                if (!alarmTime) return;

                const now = new Date();
                if (now.getHours() === alarmTime.hour && now.getMinutes() === alarmTime.minute && now.getSeconds() === 0) {
                    triggerAlarm();
                }
            }

            function triggerAlarm() {
                showAlarmModal();
                // Initialize and play sound using Tone.js
                Tone.start().then(() => {
                    alarmSound = new Tone.Synth({
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.1, decay: 0.2, sustain: 0.5, release: 1 }
                    }).toDestination();
                    
                    const pattern = new Tone.Pattern((time, note) => {
                        alarmSound.triggerAttackRelease(note, '8n', time);
                    }, ["C5", "E5", "G5", "C5"], "up");
                    
                    pattern.interval = "4n";
                    Tone.Transport.bpm.value = 140;
                    Tone.Transport.start();
                    pattern.start(0);
                });
            }

            function showAlarmModal() {
                const displayHour = (alarmTime.hour % 12 || 12).toString().padStart(2, '0');
                const displayMinute = alarmTime.minute.toString().padStart(2, '0');
                const ampm = alarmTime.hour >= 12 ? 'PM' : 'AM';
                alarmModalTime.textContent = `It's ${displayHour}:${displayMinute} ${ampm}!`;
                alarmModal.classList.add('visible');
                alarmModal.querySelector('div').classList.add('scale-100');
            }

            function hideAlarmModal() {
                alarmModal.classList.remove('visible');
                alarmModal.querySelector('div').classList.remove('scale-100');
            }


            // --- Event Listeners ---
            setAlarmBtn.addEventListener('click', setAlarm);
            clearAlarmBtn.addEventListener('click', clearAlarm);
            stopAlarmBtn.addEventListener('click', clearAlarm);

            // --- Initial Setup ---
            createHourMarkers();
            populateSelects();
            setClock();
            setInterval(setClock, 1000);
        });
    </script>
</body>
</html>
